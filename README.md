# FireFlow

This project mimics a firewall manager tool. You can create, update, delete firewalls/policies/rules. 
It respects the rule of "First match wins". 
A feature has also be implemented to simulate a firewall's response to a packet.

## Example

**Firewall Policy**:
`default_action = DENY`

**Firewall rules:**

| source_ip | port           | protocol  | action |
| ------------- | ------------- | ----- | ---- |
|192.168.1.2    | 80 | TCP   |Allow|
| 10.10.0.0     | None      | UDP   |Deny|
| None | None   |    None        | Deny  |

**Packet**
````
{
   "source_ip": 0.0.0.0,
   "port":80,
   "protocol": "tcp"
}
````
This packet will not match any rule. It partially matches some rules, but that doesn't count as an authorization. It will then fallback to the policy default action.

However, if the ip was `192.168.1.2`, it would've matched the first rule and be allowed.


## Environnement requirements
You need a .env file that is not provided. Use the .env.example to get the keys and set your values as you need

- Python 3.13.X
- Docker and Docker compose
- `chmod +x ./entrypoint.sh`

## Local use
 - Install the requirements (a virtual env is recommanded )
   - Either with `pip install -r requirements.txt` OR
   `./requirements-install.sh` 
 - Create the migrations
    - `alembic revision -m "revision message"`
 - Run the last migration 
    - `alembic upgrade head`
 - Set the last migration as the current one : 
    - `alembic stamp head`
 - Run the server in dev mode
    - `python run.py`

**A swagger is available at the root of the api**\
Such as `http://localhost:8080/`
    
## Production use

Run `docker compose up --build`\

Uses a WSGI server. You can set more or less workers as you wish. 4 is the default.

## Code architecture

This architecture is inspired by Domain Driven Development. This service is coded respecting a clear separation between the implementation and the business rules.\
![Architecture](./documentation/architecture.png)


## Testing

The library pytest is used to cover business logic, and mocked use-cases

How to run : `python -m pytest`

## Linting

This API uses flake8 for linting and is set as a pre-commit too

**The rules are black formatter friendly :** 
 - line < 88 characters
 - max complexity : 10
 - Ignore autogenerated files and __init__.py files used for packaging
 -  More rules
      - B : flake8-bugbear for potential bugs
      - C : McCabe for complexity
      - E : pep8 errors
      - F : PyFlakes for logic
      - W : pep8 warnings